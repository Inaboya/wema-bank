import { useEffect, useRef, useState } from "react";
import { NavLink, useLocation } from "react-router-dom";
import BrandLogo from "../UserDashboard/Header/BrandLogo";

interface SidebarOptions {
  sidebarOpen: boolean;
  setSidebarOpen: (x: boolean) => void;
}

function Sidebar({ sidebarOpen, setSidebarOpen }: SidebarOptions) {
  const location = useLocation();
  const { pathname } = location;

  const trigger = useRef<HTMLButtonElement | null>(null);
  const sidebar = useRef<HTMLDivElement | null>(null);

  const storedSidebarExpanded = localStorage.getItem("sidebar-expanded");
  const [sidebarExpanded] = useState(
    storedSidebarExpanded === null ? false : storedSidebarExpanded === "true"
  );

  useEffect(() => {
    const clickHandler = (event: MouseEvent) => {
      const target = event.target as Node;
      if (!sidebar.current || !trigger.current) return;
      if (
        !sidebarOpen ||
        sidebar.current.contains(target) ||
        trigger.current.contains(target)
      ) {
        return;
      }
      setSidebarOpen(false);
    };
    document.addEventListener("click", clickHandler);

    return () => document.removeEventListener("click", clickHandler);
  }, [sidebarOpen, setSidebarOpen]);

  useEffect(() => {
    const keyHandler = (keyCode: KeyboardEvent | number) => {
      if (!sidebarOpen || keyCode !== 27) return;
      setSidebarOpen(false);
    };
    document.addEventListener("keydown", keyHandler);
    return () => document.removeEventListener("keydown", keyHandler);
  }, [sidebarOpen, setSidebarOpen]);

  useEffect(() => {
    localStorage.setItem("sidebar-expanded", JSON.stringify(sidebarExpanded));
    const bodyElement = document.querySelector("body");
    if (bodyElement) {
      if (sidebarExpanded) {
        bodyElement.classList.add("sidebar-expanded");
      } else {
        bodyElement.classList.remove("sidebar-expanded");
      }
    }
  }, [sidebarExpanded]);

  return (
    <div
      id="sidebarAdmin"
      className={`h-full flex flex-col absolute z-40 left-0 top-0 lg:static lg:left-auto lg:top-auto lg:translate-x-0 overflow-y-hidden lg:overflow-y-hidden w-60 lg:w-60 lg:sidebar-expanded:!w-64 2xl:!w-60 shrink-0 bg-white dark:bg-[#121212] border-r border-slate-200 dark:border-slate-700 p-4 transition-all duration-200 ease-in-out gap-5 ${
        sidebarOpen ? "translate-x-0" : "-translate-x-64"
      }`}
      style={{ background: "#fff" }}
      ref={sidebar}
      onClick={(e) => {
        e.stopPropagation();
        setSidebarOpen(!sidebarOpen);
      }}
    >
      <div className="flex items-center justify-between gap-4">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="144"
          height="30"
          viewBox="0 0 144 30"
          fill="none"
        >
          <path
            d="M0 30V21.6562C0 17.7396 2.21875 15.5208 6.65625 15C2.21875 14.4792 0 12.2604 0 8.34375V0H6.65625V10C6.65625 10.9062 6.98437 11.6927 7.64062 12.3594C8.29688 13.0156 9.08333 13.3438 10 13.3438C10.9062 13.3438 11.6875 13.0156 12.3438 12.3594C13.0104 11.6927 13.3438 10.9062 13.3438 10V0H20V8.34375C20 12.2604 17.7812 14.4792 13.3438 15C17.7812 15.5417 20 17.7656 20 21.6719V30H13.3438V20C13.3438 19.0833 13.0104 18.2969 12.3438 17.6406C11.6875 16.9844 10.9062 16.6562 10 16.6562C9.08333 16.6562 8.29688 16.9844 7.64062 17.6406C6.98437 18.2969 6.65625 19.0833 6.65625 20V30H0Z"
            fill="#039BF0"
          />
          <path
            d="M26.6797 30V0H40.0234C41.8464 0 43.4089 0.656249 44.7109 1.96875C46.0234 3.28125 46.6797 4.84375 46.6797 6.65625V10C46.6797 11.8229 46.0234 13.3906 44.7109 14.7031C43.4089 16.0052 41.8464 16.6562 40.0234 16.6562H33.3359V30H26.6797ZM33.3359 13.3438H36.6797C37.5859 13.3438 38.3672 13.0156 39.0234 12.3594C39.6901 11.6927 40.0234 10.9062 40.0234 10V6.65625C40.0234 5.75 39.6901 4.97396 39.0234 4.32812C38.3672 3.67187 37.5859 3.34375 36.6797 3.34375H33.3359V13.3438Z"
            fill="#039BF0"
          />
          <path
            d="M53.3203 30V0H66.6641C68.487 0 70.0495 0.656249 71.3516 1.96875C72.6641 3.28125 73.3203 4.84375 73.3203 6.65625V8.46875C73.3203 9.95833 72.8099 11.3958 71.7891 12.7812C70.7682 14.1562 69.0599 14.8438 66.6641 14.8438H69.9766C70.8932 14.8438 71.6797 15.1719 72.3359 15.8281C72.9922 16.4844 73.3203 17.2708 73.3203 18.1875V30H66.6641V20C66.6641 19.0833 66.3307 18.2969 65.6641 17.6406C65.0078 16.9844 64.2266 16.6562 63.3203 16.6562H59.9766V30H53.3203ZM59.9766 13.3438H63.3203C64.2266 13.3438 65.0078 13.0156 65.6641 12.3594C66.3307 11.6927 66.6641 10.9062 66.6641 10V6.65625C66.6641 5.75 66.3307 4.97396 65.6641 4.32812C65.0078 3.67187 64.2266 3.34375 63.3203 3.34375H59.9766V13.3438Z"
            fill="#039BF0"
          />
          <path
            d="M79.9609 30V0H96.6172V3.34375H86.6172V13.3438H93.3047V16.6562H86.6172V26.6562H96.6172V30H79.9609Z"
            fill="#039BF0"
          />
          <path
            d="M119.977 6.65625H116.664C116.372 4.42708 115.32 3.3125 113.508 3.3125C112.341 3.3125 111.461 3.59375 110.867 4.15625C110.273 4.71875 109.977 5.55729 109.977 6.67188C109.977 7.50521 110.305 8.28646 110.961 9.01562L118.023 16.9531C119.326 18.4115 119.977 19.9792 119.977 21.6562V23.3438C119.977 25.1458 119.326 26.7083 118.023 28.0312C116.721 29.3438 115.154 30 113.32 30H109.977C107.768 30 106.107 29.4427 104.992 28.3281C103.878 27.2135 103.32 25.5521 103.32 23.3438H106.664C106.643 23.5729 106.633 23.7552 106.633 23.8906C106.633 24.7969 106.982 25.4844 107.68 25.9531C108.378 26.4219 109.143 26.6562 109.977 26.6562C111.164 26.6562 112.018 26.3698 112.539 25.7969C113.06 25.224 113.32 24.3906 113.32 23.2969C113.32 22.4531 112.992 21.6719 112.336 20.9531L105.273 13.0469C103.971 11.599 103.32 10.0312 103.32 8.34375V6.65625C103.32 4.84375 103.971 3.28125 105.273 1.96875C106.576 0.656249 108.143 0 109.977 0H113.32C117.487 0 119.706 2.21875 119.977 6.65625Z"
            fill="#039BF0"
          />
          <path
            d="M143.336 6.65625H140.023C139.732 4.42708 138.68 3.3125 136.867 3.3125C135.701 3.3125 134.82 3.59375 134.227 4.15625C133.633 4.71875 133.336 5.55729 133.336 6.67188C133.336 7.50521 133.664 8.28646 134.32 9.01562L141.383 16.9531C142.685 18.4115 143.336 19.9792 143.336 21.6562V23.3438C143.336 25.1458 142.685 26.7083 141.383 28.0312C140.081 29.3438 138.513 30 136.68 30H133.336C131.128 30 129.466 29.4427 128.352 28.3281C127.237 27.2135 126.68 25.5521 126.68 23.3438H130.023C130.003 23.5729 129.992 23.7552 129.992 23.8906C129.992 24.7969 130.341 25.4844 131.039 25.9531C131.737 26.4219 132.503 26.6562 133.336 26.6562C134.523 26.6562 135.378 26.3698 135.898 25.7969C136.419 25.224 136.68 24.3906 136.68 23.2969C136.68 22.4531 136.352 21.6719 135.695 20.9531L128.633 13.0469C127.331 11.599 126.68 10.0312 126.68 8.34375V6.65625C126.68 4.84375 127.331 3.28125 128.633 1.96875C129.935 0.656249 131.503 0 133.336 0H136.68C140.846 0 143.065 2.21875 143.336 6.65625Z"
            fill="#039BF0"
          />
        </svg>

        <button
          type="button"
          className="text-slate-500 hover:text-slate-600"
          aria-controls="sidebar"
          aria-expanded={sidebarOpen}
          onClick={(e) => {
            e.stopPropagation();
            setSidebarOpen(!sidebarOpen);
          }}
        >
          {sidebarOpen && (
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="30"
              height="31"
              viewBox="0 0 30 31"
              fill="none"
              cursor="pointer"
            >
              <path
                d="M16.2265 15.3368L10.127 9.23723L11.8706 7.49609L19.7124 15.3368L11.8706 23.1786L10.1282 21.435L16.2277 15.3355L16.2265 15.3368Z"
                fill="#039BF0"
              />
            </svg>
          )}
        </button>
      </div>

      <div className="space-y-8">
        <div className="w-full">
          <ul className="mt-0">
            <li
              className={`w-full mt-5 px-3 py-2 rounded-md mb-0.5 last:mb-0 ${
                pathname.includes("verifiers") &&
                "bg-[#F2FAFF] dark:bg-[#1d9bf0] border-l-4 border-solid border-[#039BF0]"
              }`}
            >
              <NavLink
                end
                to="/dashboard/verifiers"
                className={`font-poppins block truncate transition duration-150 ${
                  pathname.includes("verifiers")
                    ? "hover:text-slate-200"
                    : "hover:text-black"
                }`}
              >
                <div className="w-full flex items-center">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 20 20"
                    fill="none"
                  >
                    <path
                      d="M16.0972 13.6699C15.6083 13.1806 15.0371 12.7813 14.4097 12.4902C15.2945 11.7734 15.8589 10.6797 15.8589 9.45309C15.8589 7.28903 14.0542 5.51364 11.8902 5.54684C9.75933 5.58005 8.04253 7.31638 8.04253 9.45309C8.04253 10.6797 8.60894 11.7734 9.49175 12.4902C8.86422 12.7811 8.29296 13.1804 7.80425 13.6699C6.73784 14.7383 6.13237 16.1484 6.09331 17.6523C6.09279 17.6732 6.09645 17.6939 6.10406 17.7133C6.11168 17.7327 6.12311 17.7504 6.13767 17.7653C6.15223 17.7803 6.16963 17.7921 6.18885 17.8002C6.20807 17.8083 6.22871 17.8125 6.24956 17.8125H7.34331C7.4273 17.8125 7.49761 17.7461 7.49956 17.6621C7.53667 16.5293 7.99566 15.4687 8.8023 14.664C9.21507 14.2491 9.70605 13.9201 10.2468 13.6961C10.7876 13.4722 11.3674 13.3577 11.9527 13.3593C13.1421 13.3593 14.2613 13.8222 15.1031 14.664C15.9078 15.4687 16.3667 16.5293 16.4058 17.6621C16.4078 17.7461 16.4781 17.8125 16.5621 17.8125H17.6558C17.6767 17.8125 17.6973 17.8083 17.7165 17.8002C17.7357 17.7921 17.7531 17.7803 17.7677 17.7653C17.7823 17.7504 17.7937 17.7327 17.8013 17.7133C17.8089 17.6939 17.8126 17.6732 17.8121 17.6523C17.773 16.1484 17.1675 14.7383 16.0972 13.6699ZM11.9527 11.9531C11.2847 11.9531 10.6558 11.6933 10.1851 11.2207C9.94888 10.9863 9.76229 10.7068 9.63645 10.3987C9.51061 10.0907 9.44812 9.76043 9.45269 9.4277C9.45855 8.78708 9.71441 8.16794 10.1617 7.70895C10.6304 7.22849 11.2574 6.96091 11.9273 6.95309C12.5894 6.94724 13.232 7.20505 13.7046 7.66794C14.189 8.14255 14.4546 8.77731 14.4546 9.45309C14.4546 10.1211 14.1949 10.748 13.7222 11.2207C13.4903 11.4537 13.2145 11.6384 12.9108 11.7641C12.6071 11.8898 12.2814 11.9541 11.9527 11.9531ZM7.06011 9.96872C7.04253 9.7988 7.03276 9.62692 7.03276 9.45309C7.03276 9.14255 7.06206 8.83981 7.11675 8.54489C7.13042 8.47458 7.09331 8.40231 7.02886 8.37302C6.76323 8.25388 6.51909 8.08981 6.30815 7.88278C6.0596 7.64178 5.86401 7.35161 5.73387 7.0308C5.60372 6.70998 5.54188 6.36555 5.55229 6.0195C5.56987 5.39255 5.82183 4.79684 6.26128 4.34763C6.7437 3.85349 7.39214 3.58395 8.08159 3.59177C8.70464 3.59763 9.3062 3.83786 9.76128 4.26364C9.91558 4.40817 10.0484 4.56833 10.1597 4.7402C10.1988 4.80075 10.275 4.82614 10.3414 4.8027C10.6851 4.68356 11.0484 4.59958 11.4214 4.56052C11.5308 4.5488 11.5933 4.43161 11.5445 4.33395C10.9097 3.07809 9.61284 2.21091 8.11284 2.18747C5.94683 2.15427 4.14214 3.92966 4.14214 6.09177C4.14214 7.31833 4.70659 8.41208 5.59136 9.12888C4.97026 9.41599 4.398 9.81247 3.9019 10.3086C2.83159 11.3769 2.22612 12.7871 2.18706 14.2929C2.18654 14.3138 2.1902 14.3345 2.19781 14.3539C2.20543 14.3733 2.21686 14.391 2.23142 14.406C2.24598 14.4209 2.26338 14.4327 2.2826 14.4408C2.30182 14.4489 2.32246 14.4531 2.34331 14.4531H3.43901C3.523 14.4531 3.59331 14.3867 3.59526 14.3027C3.63237 13.1699 4.09136 12.1093 4.898 11.3047C5.47222 10.7304 6.17534 10.332 6.94292 10.1386C7.01909 10.1191 7.06987 10.0468 7.06011 9.96872Z"
                      fill="#039BF0"
                    />
                  </svg>
                  <span
                    className={`text-sm font-medium ml-3 2xl:opacity-100 duration-200 ${
                      pathname.includes("verifiers")
                        ? "text-[#039BF0]"
                        : "text-[#1A1619]"
                    }`}
                  >
                    Verifiers
                  </span>
                </div>
              </NavLink>
            </li>

            <li
              className={`w-full mt-5 px-3 py-2 rounded-md mb-0.5 last:mb-0 ${
                pathname.includes("deals") &&
                "bg-[#F2FAFF] dark:bg-[#1d9bf0] border-l-4 border-solid border-[#039BF0]"
              }`}
            >
              <NavLink
                end
                to="/dashboard/verifiers"
                className={`font-poppins block truncate transition duration-150 ${
                  pathname.includes("deals")
                    ? "hover:text-slate-200"
                    : "hover:text-black"
                }`}
              >
                <div className="w-full flex items-center">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="22"
                    viewBox="0 0 20 22"
                    fill="none"
                  >
                    <path
                      d="M9.21463 17.0595L17.0593 9.21268C17.0946 9.17742 17.1112 9.12971 17.107 9.08201L16.5781 2.83031C16.5636 2.66852 16.4371 2.542 16.2753 2.52748L10.0236 2.00062C9.97587 1.99648 9.92609 2.01307 9.8929 2.04833L2.0482 9.89303C2.01732 9.92421 2 9.96633 2 10.0102C2 10.0541 2.01732 10.0962 2.0482 10.1274L8.98024 17.0595C9.04455 17.1258 9.15033 17.1258 9.21463 17.0595ZM10.5131 3.54177L15.1718 3.93587L15.5659 8.59457L9.0964 15.062L4.0436 10.0113L10.5131 3.54177ZM11.7609 7.40459C11.8534 7.49704 11.9632 7.57037 12.084 7.6204C12.2048 7.67042 12.3343 7.69617 12.465 7.69616C12.5958 7.69615 12.7252 7.67039 12.846 7.62034C12.9668 7.57029 13.0766 7.49695 13.169 7.40448C13.2615 7.31202 13.3348 7.20225 13.3848 7.08145C13.4349 6.96065 13.4606 6.83117 13.4606 6.70042C13.4606 6.56967 13.4348 6.4402 13.3848 6.3194C13.3347 6.1986 13.2614 6.08885 13.1689 5.9964C13.0765 5.90395 12.9667 5.83062 12.8459 5.78059C12.7251 5.73056 12.5956 5.70482 12.4649 5.70483C12.3341 5.70484 12.2046 5.7306 12.0838 5.78065C11.963 5.83069 11.8533 5.90404 11.7608 5.9965C11.6684 6.08897 11.5951 6.19873 11.545 6.31954C11.495 6.44034 11.4693 6.56981 11.4693 6.70057C11.4693 6.83132 11.495 6.96079 11.5451 7.08159C11.5951 7.20238 11.6685 7.31214 11.7609 7.40459ZM17.6463 11.8635L16.8249 11.0442C16.7938 11.0133 16.7516 10.996 16.7077 10.996C16.6639 10.996 16.6217 11.0133 16.5906 11.0442L9.08188 18.5384L4.15354 13.6225C4.12235 13.5916 4.08023 13.5743 4.03634 13.5743C3.99245 13.5743 3.95034 13.5916 3.91915 13.6225L3.09776 14.4418C3.06688 14.473 3.04955 14.5151 3.04955 14.559C3.04955 14.6029 3.06688 14.645 3.09776 14.6762L8.14226 19.7124L8.96365 20.5317C9.02795 20.596 9.13374 20.596 9.19804 20.5317L17.6463 12.0979C17.7106 12.0336 17.7106 11.9278 17.6463 11.8635Z"
                      fill="#1A1619"
                    />
                  </svg>
                  <span
                    className={`text-sm font-medium ml-3 2xl:opacity-100 duration-200 ${
                      pathname.includes("deals")
                        ? "text-[#039BF0]"
                        : "text-[#1A1619]"
                    }`}
                  >
                    Deals
                  </span>
                </div>
              </NavLink>
            </li>

            <li
              className={`w-full mt-5 px-3 py-2 rounded-md mb-0.5 last:mb-0 ${
                pathname.includes("transactions") &&
                "bg-[#F2FAFF] dark:bg-[#1d9bf0] border-l-4 border-solid border-[#039BF0]"
              }`}
            >
              <NavLink
                end
                to="/dashboard/transactions"
                className={`font-poppins block truncate transition duration-150 ${
                  pathname.includes("transactions")
                    ? "hover:text-slate-200"
                    : "hover:text-black"
                }`}
              >
                <div className="w-full flex items-center">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 20 20"
                    fill="none"
                  >
                    <path
                      d="M9.85049 6.3667C8.27659 6.3667 7.00049 7.64363 7.00049 9.21855C7.00049 10.7937 8.27659 12.0704 9.85049 12.0704C11.4246 12.0704 12.7005 10.7937 12.7005 9.21855C12.6987 7.64442 11.4238 6.36849 9.85049 6.3667ZM9.85049 11.2556C8.72627 11.2556 7.81477 10.3437 7.81477 9.21855C7.81477 8.0936 8.72627 7.18151 9.85049 7.18151C10.9749 7.18151 11.8862 8.0936 11.8862 9.21855C11.885 10.3431 10.9743 11.2544 9.85049 11.2556Z"
                      fill="#1A1619"
                    />
                    <path
                      d="M2.87066 5.44445H3.54967V4.62964H2.53116C2.34367 4.62964 2.19165 4.81206 2.19165 5.03705V6.25927H2.87066V5.44445Z"
                      fill="#1A1619"
                    />
                    <path
                      d="M2.87066 12.7778H2.19165V14.0001C2.19165 14.2252 2.34367 14.4075 2.53116 14.4075H3.54967V13.5926H2.87066V12.7778Z"
                      fill="#1A1619"
                    />
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M0.633057 3.40746V15.6297C0.633057 15.9297 0.842077 16.2371 1.17256 16.2371H18.8269C19.1576 16.2371 19.3664 15.9296 19.3664 15.6297V3.40746C19.3664 3.10777 19.1577 2.80005 18.8269 2.80005H1.17256C0.842021 2.80005 0.633057 3.1077 0.633057 3.40746ZM1.71207 4.01486H18.2874V15.0223H1.71207V4.01486ZM0.833057 3.40746V15.6297C0.833057 15.7555 0.880531 15.8679 0.95514 15.9426C0.880643 15.8679 0.833252 15.7556 0.833252 15.6299V3.40765C0.833252 3.18266 0.985267 3.00024 1.17276 3.00024H18.8271C18.9099 3.00024 18.9857 3.03575 19.0446 3.09475C18.9857 3.03563 18.9098 3.00005 18.8269 3.00005H1.17256C0.985072 3.00005 0.833057 3.18247 0.833057 3.40746ZM1.51226 15.2223V15.2225H18.4876V3.81506H18.4874V15.2223H1.51226Z"
                      fill="#1A1619"
                    />
                    <path
                      d="M17.0627 7.62524C16.0277 7.62415 15.1888 6.61743 15.1877 5.37524C15.1877 5.16815 15.048 5.00024 14.8752 5.00024H5.50024C5.32767 5.00024 5.18774 5.16815 5.18774 5.37524C5.18683 6.61743 4.3479 7.62415 3.31274 7.62524C3.14017 7.62524 3.00024 7.79315 3.00024 8.00024V11.0002C3.00024 11.2075 3.14017 11.3752 3.31274 11.3752C4.3479 11.3765 5.18683 12.3832 5.18774 13.6252C5.18774 13.8325 5.32767 14.0002 5.50024 14.0002H14.8752C15.048 14.0002 15.1877 13.8325 15.1877 13.6252C15.1888 12.3832 16.0277 11.3765 17.0627 11.3752C17.2355 11.3752 17.3752 11.2075 17.3752 11.0002V8.00024C17.3752 7.79315 17.2355 7.62524 17.0627 7.62524ZM16.7502 10.6485C15.6182 10.8221 14.7268 11.8918 14.5821 13.2502H5.79337C5.64871 11.8918 4.75745 10.8221 3.62524 10.6485V8.35199C4.75745 8.17841 5.64871 7.10889 5.79337 5.75024H14.5821C14.7268 7.10889 15.6182 8.17841 16.7502 8.35199V10.6485Z"
                      fill="#1A1619"
                    />
                    <path
                      d="M17.469 4.62964H16.4504V5.44445H17.1295V6.25927H17.8085V5.03705C17.8085 4.81206 17.6566 4.62964 17.469 4.62964Z"
                      fill="#1A1619"
                    />
                    <path
                      d="M17.1295 13.5926H16.4504V14.4075H17.469C17.6566 14.4075 17.8085 14.2252 17.8085 14.0001V12.7778H17.1295V13.5926Z"
                      fill="#1A1619"
                    />
                    <path
                      d="M9.02319 8.88869V9.16699H10.6611V8.88869H9.02319Z"
                      fill="#1A1619"
                    />
                    <path
                      d="M9.02319 9.53248V9.81079H10.6611V9.53248H9.02319Z"
                      fill="#1A1619"
                    />
                    <path
                      d="M10.2071 8.36373H10.4401V10.2976H10.361L9.47718 8.9776V10.2659H9.24414V8.33203H9.32548L10.2071 9.64623V8.36373Z"
                      fill="#1A1619"
                    />
                  </svg>
                  <span
                    className={`text-sm font-medium ml-3 2xl:opacity-100 duration-200 ${
                      pathname.includes("transactions")
                        ? "text-[#039BF0]"
                        : "text-[#1A1619]"
                    }`}
                  >
                    Transactions
                  </span>
                </div>
              </NavLink>
            </li>
          </ul>
        </div>
      </div>
    </div>
  );
}

export default Sidebar;
